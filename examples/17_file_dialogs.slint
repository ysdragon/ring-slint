enum IconType {
    none,
    folder-open,
    file,
    files,
    save,
    folder,
    folders,
    chat,
    clipboard,
    info,
    warning,
    error,
    question,
    check,
}

// Icon path data lookup
global IconPaths {
    out property <string> folder-open: "M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z";
    out property <string> file: "M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z";
    out property <string> files: "M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z";
    out property <string> save: "M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z";
    out property <string> folder: "M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z";
    out property <string> folders: "M22 8v10c0 1.1-.9 2-2 2H6c0 1.1.9 2 2 2h12c2.2 0 4-1.8 4-4V8c0-1.1-.9-2-2-2zm-4-2l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-6z";
    out property <string> chat: "M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z";
    out property <string> clipboard: "M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 16H5V5h2v2h10V5h2v14z";
    out property <string> info: "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z";
    out property <string> warning: "M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z";
    out property <string> error: "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z";
    out property <string> question: "M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z";
    out property <string> check: "M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z";
}

// Reusable Icon component
component Icon inherits Rectangle {
    in property <IconType> icon-type: IconType.none;
    in property <color> icon-color: Theme.text-muted;
    in property <length> icon-size: 16px;
    
    width: icon-size;
    height: icon-size;
    
    Path {
        width: 100%;
        height: 100%;
        viewbox-width: 24;
        viewbox-height: 24;
        fill: icon-color;
        commands: icon-type == IconType.folder-open ? IconPaths.folder-open
                : icon-type == IconType.file ? IconPaths.file
                : icon-type == IconType.files ? IconPaths.files
                : icon-type == IconType.save ? IconPaths.save
                : icon-type == IconType.folder ? IconPaths.folder
                : icon-type == IconType.folders ? IconPaths.folders
                : icon-type == IconType.chat ? IconPaths.chat
                : icon-type == IconType.clipboard ? IconPaths.clipboard
                : icon-type == IconType.info ? IconPaths.info
                : icon-type == IconType.warning ? IconPaths.warning
                : icon-type == IconType.error ? IconPaths.error
                : icon-type == IconType.question ? IconPaths.question
                : icon-type == IconType.check ? IconPaths.check
                : "";
    }
}

global Theme {
    // Backgrounds
    out property <color> bg-base: #07070a;
    out property <color> bg-surface: #0d0d12;
    out property <color> bg-elevated: #141419;
    out property <color> bg-overlay: #1a1b23;
    
    // Accents
    out property <color> accent-primary: #8b5cf6;
    out property <color> accent-secondary: #6366f1;
    out property <color> accent-cyan: #06b6d4;
    out property <color> accent-success: #22c55e;
    out property <color> accent-warning: #f59e0b;
    out property <color> accent-error: #ef4444;
    
    // Text
    out property <color> text-primary: #f8fafc;
    out property <color> text-secondary: #94a3b8;
    out property <color> text-muted: #64748b;
    
    // Borders
    out property <color> border-subtle: #ffffff08;
    out property <color> border-medium: #ffffff12;
    out property <color> border-strong: #ffffff20;
    
    // Spacing
    out property <length> space-xs: 4px;
    out property <length> space-sm: 8px;
    out property <length> space-md: 12px;
    out property <length> space-lg: 16px;
    out property <length> space-xl: 24px;
    out property <length> space-2xl: 32px;
    
    // Radius
    out property <length> radius-sm: 6px;
    out property <length> radius-md: 10px;
    out property <length> radius-lg: 14px;
    out property <length> radius-xl: 20px;
}

component ThemedScrollView inherits Rectangle {
    in property <length> viewport-height;
    in-out property <length> viewport-y: 0;

    property <length> scroll-range: max(0px, viewport-height - root.height);

    clip: true;
    background: transparent;

    TouchArea {
        width: parent.width - 14px;
        height: parent.height;

        scroll-event(e) => {
            viewport-y = clamp(viewport-y + e.delta-y * 0.5, -scroll-range, 0px);
            accept
        }
    }

    Rectangle {
        y: viewport-y;
        width: parent.width - 14px;
        height: viewport-height;

        @children
    }

    // Scrollbar track
    scrollbar := Rectangle {
        x: parent.width - 8px;
        width: 6px;
        height: parent.height;
        background: Theme.bg-overlay;
        border-radius: 3px;

        property <length> thumb-h: max(40px, self.height * self.height / max(1px, viewport-height));
        property <length> thumb-range: self.height - self.thumb-h;

        track-touch := TouchArea {
            clicked => {
                root.viewport-y = clamp(
                    -(self.mouse-y - scrollbar.thumb-h / 2) * scroll-range / scrollbar.thumb-range,
                    -scroll-range,
                    0px
                );
            }
        }

        // Thumb
        Rectangle {
            width: parent.width;
            height: scrollbar.thumb-h;
            y: scroll-range > 0px ? -viewport-y * scrollbar.thumb-range / scroll-range : 0px;
            background: thumb-touch.pressed ? Theme.accent-primary : thumb-touch.has-hover ? Theme.text-muted : Theme.border-strong;
            border-radius: 3px;
            
            animate background { duration: 150ms; easing: ease-out; }

            thumb-touch := TouchArea {
                moved => {
                    if self.pressed {
                        root.viewport-y = clamp(
                            root.viewport-y - (self.mouse-y - self.pressed-y) * scroll-range / scrollbar.thumb-range,
                            -scroll-range,
                            0px
                        );
                    }
                }
            }
        }
    }
}

component ActionButton inherits Rectangle {
    in property <string> text;
    in property <IconType> icon: IconType.none;
    in property <color> accent: Theme.accent-secondary;
    
    callback clicked();
    
    height: 44px;
    min-width: 110px;
    horizontal-stretch: 1;
    background: touch.pressed 
        ? Theme.bg-overlay 
        : touch.has-hover 
            ? Theme.bg-elevated 
            : Theme.bg-surface;
    border-radius: Theme.radius-md;
    border-width: 1px;
    border-color: touch.has-hover ? accent.with-alpha(0.4) : Theme.border-subtle;
    
    drop-shadow-blur: touch.has-hover ? 12px : 0px;
    drop-shadow-color: accent.with-alpha(0.2);
    
    animate background { duration: 150ms; easing: ease-out; }
    animate border-color { duration: 150ms; easing: ease-out; }
    animate drop-shadow-blur { duration: 200ms; }
    
    touch := TouchArea {
        mouse-cursor: pointer;
        clicked => { root.clicked(); }
    }
    
    HorizontalLayout {
        padding-left: Theme.space-md;
        padding-right: Theme.space-md;
        spacing: Theme.space-sm;
        alignment: center;
        
        if icon != IconType.none : VerticalLayout {
            alignment: center;
            Icon {
                icon-type: icon;
                icon-color: touch.has-hover ? accent : Theme.text-muted;
                icon-size: 16px;
            }
        }
        
        Text {
            text: root.text;
            color: touch.has-hover ? Theme.text-primary : Theme.text-secondary;
            font-size: 13px;
            font-weight: 500;
            vertical-alignment: center;
            
            animate color { duration: 150ms; }
        }
    }
}

component SectionCard inherits Rectangle {
    in property <string> title;
    in property <IconType> icon: IconType.none;
    in property <color> accent: Theme.accent-primary;
    
    background: Theme.bg-surface;
    border-radius: Theme.radius-lg;
    border-width: 1px;
    border-color: Theme.border-subtle;
    
    // Top accent line
    Rectangle {
        x: Theme.space-xl;
        y: 0;
        width: parent.width - Theme.space-xl * 2;
        height: 1px;
        background: @linear-gradient(90deg, transparent 0%, accent.with-alpha(0.3) 50%, transparent 100%);
    }
    
    VerticalLayout {
        padding: Theme.space-lg;
        spacing: Theme.space-md;
        
        // Header
        HorizontalLayout {
            spacing: Theme.space-sm;
            
            if icon != IconType.none : Rectangle {
                width: 24px;
                height: 24px;
                border-radius: Theme.radius-sm;
                background: accent.with-alpha(0.15);
                
                Icon {
                    icon-type: icon;
                    icon-color: accent;
                    icon-size: 12px;
                    x: (parent.width - self.width) / 2;
                    y: (parent.height - self.height) / 2;
                }
            }
            
            Text {
                text: title;
                color: Theme.text-muted;
                font-size: 11px;
                font-weight: 600;
                letter-spacing: 1px;
                vertical-alignment: center;
            }
        }
        
        @children
    }
}

component ResultDisplay inherits Rectangle {
    in property <string> result: "";
    
    property <bool> has-result: result != "Click a button to open a dialog..." && result != "";
    
    min-height: 120px;
    background: Theme.bg-base;
    border-radius: Theme.radius-md;
    border-width: 1px;
    border-color: Theme.border-subtle;
    
    ThemedScrollView {
        width: 100%;
        height: 100%;
        viewport-height: content.preferred-height;
        
        content := VerticalLayout {
            padding: Theme.space-lg;
            spacing: Theme.space-sm;
            
            // Status indicator
            HorizontalLayout {
                spacing: Theme.space-sm;
                
                Rectangle {
                    width: 8px;
                    height: 8px;
                    border-radius: 4px;
                    background: has-result ? Theme.accent-success : Theme.text-muted;
                    
                    // Pulse ring
                    Rectangle {
                        x: -3px;
                        y: -3px;
                        width: 14px;
                        height: 14px;
                        border-radius: 7px;
                        background: has-result ? Theme.accent-success.with-alpha(0.2) : transparent;
                    }
                }
                
                Text {
                    text: has-result ? "RESULT" : "READY";
                    color: has-result ? Theme.accent-success : Theme.text-muted;
                    font-size: 10px;
                    font-weight: 700;
                    letter-spacing: 1px;
                    vertical-alignment: center;
                }
            }
            
            Rectangle { height: Theme.space-sm; }
            
            Text {
                text: result == "" ? "Click a button to open a dialog..." : result;
                color: has-result ? Theme.text-secondary : Theme.text-muted;
                font-size: 13px;
                font-family: "monospace";
                wrap: word-wrap;
            }
        }
    }
}

export component App inherits Window {
    title: "Native File Dialogs";
    width: 560px;
    height: 600px;
    background: Theme.bg-base;

    callback open-file();
    callback open-file-simple();
    callback open-files();
    callback open-files-simple();
    callback save-file();
    callback save-file-simple();
    callback save-file-name();
    callback open-folder();
    callback open-folders();
    callback show-msgbox();
    callback show-msgbox-warning();
    callback show-msgbox-error();
    callback show-confirm();
    callback show-yesno();

    in-out property <string> result-text: "Click a button to open a dialog...";

    // Ambient background glow
    Rectangle {
        x: -80px;
        y: -80px;
        width: 280px;
        height: 280px;
        border-radius: 140px;
        background: @radial-gradient(circle, Theme.accent-secondary.with-alpha(0.06) 0%, transparent 70%);
    }
    
    Rectangle {
        x: parent.width - 120px;
        y: parent.height - 180px;
        width: 220px;
        height: 220px;
        border-radius: 110px;
        background: @radial-gradient(circle, Theme.accent-primary.with-alpha(0.06) 0%, transparent 70%);
    }

    ThemedScrollView {
        viewport-height: main-content.preferred-height;
        
        main-content := VerticalLayout {
            padding: Theme.space-2xl;
            spacing: Theme.space-xl;

            HorizontalLayout {
            alignment: center;
            spacing: Theme.space-lg;
            
            // Icon
            Rectangle {
                width: 52px;
                height: 52px;
                border-radius: Theme.radius-lg;
                background: @linear-gradient(135deg, Theme.accent-secondary.with-alpha(0.2) 0%, Theme.accent-primary.with-alpha(0.2) 100%);
                border-width: 1px;
                border-color: Theme.accent-secondary.with-alpha(0.3);
                
                Icon {
                    icon-type: IconType.folder-open;
                    icon-color: Theme.text-primary;
                    icon-size: 26px;
                    x: (parent.width - self.width) / 2;
                    y: (parent.height - self.height) / 2;
                }
            }
            
            VerticalLayout {
                alignment: center;
                spacing: Theme.space-xs;
                
                Text {
                    text: "File Dialogs";
                    font-size: 28px;
                    font-weight: 700;
                    color: Theme.text-primary;
                }
                
                Text {
                    text: "Native system dialogs via rfd";
                    color: Theme.text-muted;
                    font-size: 13px;
                }
            }
        }

        SectionCard {
            title: "FILE OPERATIONS";
            icon: IconType.file;
            accent: Theme.accent-secondary;
            
            VerticalLayout {
                spacing: Theme.space-md;
                
                HorizontalLayout {
                    spacing: Theme.space-md;
                    
                    ActionButton {
                        text: "Open File";
                        icon: IconType.folder-open;
                        accent: Theme.accent-secondary;
                        clicked => { open-file(); }
                    }
                    
                    ActionButton {
                        text: "Open Simple";
                        icon: IconType.folder-open;
                        accent: Theme.accent-secondary;
                        clicked => { open-file-simple(); }
                    }
                    
                    ActionButton {
                        text: "Open Multiple";
                        icon: IconType.files;
                        accent: Theme.accent-secondary;
                        clicked => { open-files(); }
                    }
                }
                
                HorizontalLayout {
                    spacing: Theme.space-md;
                    
                    ActionButton {
                        text: "Multi Simple";
                        icon: IconType.files;
                        accent: Theme.accent-secondary;
                        clicked => { open-files-simple(); }
                    }
                    
                    ActionButton {
                        text: "Save File";
                        icon: IconType.save;
                        accent: Theme.accent-success;
                        clicked => { save-file(); }
                    }
                    
                    ActionButton {
                        text: "Save Simple";
                        icon: IconType.save;
                        accent: Theme.accent-success;
                        clicked => { save-file-simple(); }
                    }
                }
                
                HorizontalLayout {
                    spacing: Theme.space-md;
                    
                    ActionButton {
                        text: "Save Named";
                        icon: IconType.save;
                        accent: Theme.accent-success;
                        clicked => { save-file-name(); }
                    }
                    
                    Rectangle { horizontal-stretch: 1; }
                }
            }
        }

        SectionCard {
            title: "FOLDER OPERATIONS";
            icon: IconType.folder;
            accent: Theme.accent-cyan;
            
            HorizontalLayout {
                spacing: Theme.space-md;
                
                ActionButton {
                    text: "Open Folder";
                    icon: IconType.folder;
                    accent: Theme.accent-cyan;
                    clicked => { open-folder(); }
                }
                
                ActionButton {
                    text: "Open Folders";
                    icon: IconType.folders;
                    min-width: 110px;
                    accent: Theme.accent-cyan;
                    clicked => { open-folders(); }
                }
                
                Rectangle { horizontal-stretch: 1; }
            }
        }

        SectionCard {
            title: "MESSAGE DIALOGS";
            icon: IconType.chat;
            accent: Theme.accent-warning;
            
            VerticalLayout {
                spacing: Theme.space-md;
                
                HorizontalLayout {
                    spacing: Theme.space-md;
                    
                    ActionButton {
                        text: "Info Box";
                        icon: IconType.info;
                        accent: Theme.accent-secondary;
                        clicked => { show-msgbox(); }
                    }
                    
                    ActionButton {
                        text: "Warning";
                        icon: IconType.warning;
                        accent: Theme.accent-warning;
                        clicked => { show-msgbox-warning(); }
                    }
                    
                    ActionButton {
                        text: "Error";
                        icon: IconType.error;
                        accent: Theme.accent-error;
                        clicked => { show-msgbox-error(); }
                    }
                }
                
                HorizontalLayout {
                    spacing: Theme.space-md;
                    
                    ActionButton {
                        text: "Confirm";
                        icon: IconType.question;
                        accent: Theme.accent-warning;
                        clicked => { show-confirm(); }
                    }
                    
                    ActionButton {
                        text: "Yes / No";
                        icon: IconType.check;
                        accent: Theme.accent-success;
                        clicked => { show-yesno(); }
                    }
                    
                    Rectangle { horizontal-stretch: 1; }
                }
            }
        }

        // ─────────────────────────────────────────────────────────────────────
        // Output Display
        // ─────────────────────────────────────────────────────────────────────
        SectionCard {
            title: "OUTPUT";
            icon: IconType.clipboard;
            accent: Theme.accent-primary;
            vertical-stretch: 1;
            
            ResultDisplay {
                result: result-text;
                vertical-stretch: 1;
            }
        }
        }
    }
}
