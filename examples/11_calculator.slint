component CalcButton inherits Rectangle {
    in property <string> label;
    in property <color> bg: #1e1f24;
    in property <color> text-color: #f8fafc;
    in property <bool> wide: false;
    in property <bool> is-operator: false;
    callback clicked();

    min-width: wide ? 148px : 68px;
    min-height: 68px;
    border-radius: 20px;
    background: touch.pressed ? bg.darker(25%) 
              : touch.has-hover ? bg.brighter(12%) 
              : bg;
    border-width: is-operator ? 0px : 1px;
    border-color: #ffffff08;
    drop-shadow-blur: touch.has-hover ? 12px : 4px;
    drop-shadow-color: is-operator ? bg.with-alpha(0.4) : #00000020;
    drop-shadow-offset-y: 2px;

    animate background { duration: 120ms; easing: ease-out; }
    animate drop-shadow-blur { duration: 120ms; easing: ease-out; }

    touch := TouchArea {
        clicked => { root.clicked(); }
    }

    Text {
        width: 100%;
        height: 100%;
        text: label;
        color: text-color;
        font-size: 28px;
        font-weight: 500;
        horizontal-alignment: center;
        vertical-alignment: center;
    }
}

export component App inherits Window {
    title: "Calculator";
    width: 380px;
    height: 600px;
    background: #07070a;

    // === API: Keep all callbacks and properties ===
    callback digit(string);
    callback operator(string);
    callback equals();
    callback clear();
    callback decimal();
    callback negate();
    callback percent();

    in-out property <string> display: "0";

    // === Design System Tokens ===
    property <color> surface: #0f1014;
    property <color> surface-elevated: #16171c;
    property <color> btn-number: #1e1f24;
    property <color> btn-function: #4a4b50;
    property <color> btn-operator: #f59e0b;
    property <color> text-primary: #f8fafc;
    property <color> text-dark: #07070a;

    // Background gradient
    Rectangle {
        width: 100%;
        height: 100%;
        background: @linear-gradient(180deg, #0f1014 0%, #07070a 100%);
    }

    VerticalLayout {
        padding: 24px;
        spacing: 16px;

        // Display area
        Rectangle {
            height: 120px;
            background: transparent;

            // Subtle glow under display
            Rectangle {
                x: parent.width - 200px;
                y: parent.height - 40px;
                width: 180px;
                height: 30px;
                background: @radial-gradient(circle, #f59e0b15 0%, transparent 70%);
            }

            VerticalLayout {
                alignment: end;
                padding-right: 12px;
                padding-bottom: 12px;

                Text {
                    text: display;
                    color: text-primary;
                    font-size: 64px;
                    font-weight: 300;
                    horizontal-alignment: right;
                }
            }
        }

        // Separator
        Rectangle {
            height: 1px;
            background: @linear-gradient(90deg, transparent 0%, #ffffff15 50%, transparent 100%);
        }

        // Calculator grid
        VerticalLayout {
            spacing: 12px;

            // Row 1: C, ±, %, ÷
            HorizontalLayout {
                spacing: 12px;
                CalcButton { label: "C"; bg: btn-function; text-color: text-dark; clicked => { clear(); } }
                CalcButton { label: "±"; bg: btn-function; text-color: text-dark; clicked => { negate(); } }
                CalcButton { label: "%"; bg: btn-function; text-color: text-dark; clicked => { percent(); } }
                CalcButton { label: "÷"; bg: btn-operator; text-color: text-primary; is-operator: true; clicked => { operator("/"); } }
            }

            // Row 2: 7, 8, 9, ×
            HorizontalLayout {
                spacing: 12px;
                CalcButton { label: "7"; clicked => { digit("7"); } }
                CalcButton { label: "8"; clicked => { digit("8"); } }
                CalcButton { label: "9"; clicked => { digit("9"); } }
                CalcButton { label: "×"; bg: btn-operator; text-color: text-primary; is-operator: true; clicked => { operator("*"); } }
            }

            // Row 3: 4, 5, 6, −
            HorizontalLayout {
                spacing: 12px;
                CalcButton { label: "4"; clicked => { digit("4"); } }
                CalcButton { label: "5"; clicked => { digit("5"); } }
                CalcButton { label: "6"; clicked => { digit("6"); } }
                CalcButton { label: "−"; bg: btn-operator; text-color: text-primary; is-operator: true; clicked => { operator("-"); } }
            }

            // Row 4: 1, 2, 3, +
            HorizontalLayout {
                spacing: 12px;
                CalcButton { label: "1"; clicked => { digit("1"); } }
                CalcButton { label: "2"; clicked => { digit("2"); } }
                CalcButton { label: "3"; clicked => { digit("3"); } }
                CalcButton { label: "+"; bg: btn-operator; text-color: text-primary; is-operator: true; clicked => { operator("+"); } }
            }

            // Row 5: 0 (wide), ., =
            HorizontalLayout {
                spacing: 12px;
                CalcButton { label: "0"; wide: true; clicked => { digit("0"); } }
                CalcButton { label: "."; clicked => { decimal(); } }
                CalcButton { label: "="; bg: btn-operator; text-color: text-primary; is-operator: true; clicked => { equals(); } }
            }
        }
    }
}
